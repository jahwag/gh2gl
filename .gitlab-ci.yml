stages:
  - sync

sync_git:
  stage: sync
  image: $REGISTRYURL_IMAGES/digg/java-runner:21.0.1
  script:
    - microdnf install ssh git
    - mkdir -p ~/.ssh
    - touch ~/.ssh/config
    - echo -e "Host github.com\n    ProxyCommand        nc -X connect -x proxy.digg.se:8080 %h %p \n    Hostname ssh.github.com\n    Port 443\n    User git" >> ~/.ssh/config
    - cat ~/.ssh/config
    - git config --global http.proxy $GITLAB_PROXY_URL
    - git clone git@github.com:jahwag/gh2gl.git
    - cd gh2gl
    - git remote add gitlab $GITLAB_REPO_URL
    - git fetch origin
    - git checkout master
    - git pull origin master
    - git push gitlab master
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - when: manual
